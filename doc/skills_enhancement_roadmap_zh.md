# Skills Self-Update å¢å¼ºè·¯çº¿å›¾

> æœ¬æ–‡æ¡£åŸºäº shipyard-neo ç°æœ‰ Skills åŸºå»ºçš„å…¨é“¾è·¯åˆ†æï¼Œç»“åˆè¡Œä¸šæœ€æ–°æŠ€èƒ½è¯„æµ‹è¶‹åŠ¿ï¼ˆCRAB / SETA / WebArena / AgentBench ç­‰ï¼‰ï¼Œæå‡º 10 ä¸ªå¯å¢å¼ºæ–¹å‘ï¼ŒæŒ‰ä¼˜å…ˆçº§åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µã€‚
>
> å®šä½ï¼šæœ¬æ–‡æ¡£æ˜¯**æœªæ¥æŒ‡å¯¼æ–‡æ¡£**ï¼Œæ¯ä¸ªæ–¹å‘åŒ…å«ç°çŠ¶åˆ†æã€ç›®æ ‡è®¾è®¡ã€å…³é”®æŠ€æœ¯å†³ç­–å’Œè½åœ°å»ºè®®ã€‚

---

## é˜¶æ®µä¸€ï¼šæ ¸å¿ƒèƒ½åŠ›å¢å¼º ğŸ”´

ä½¿ Skills ä»"èƒ½ç”¨çš„åŸºå»º"è¿›åŒ–ä¸º"å¥½ç”¨çš„åŸºå»º"ï¼Œç›´æ¥æå‡æŠ€èƒ½å¤ç”¨ç‡å’Œæ‰§è¡ŒæˆåŠŸç‡ã€‚

---

### 1. æŠ€èƒ½æå–æ™ºèƒ½åŒ–

#### 1.1 ç°çŠ¶

`BrowserLearningScheduler`ï¼ˆ`app/services/skills/scheduler.py`ï¼‰é‡‡ç”¨**è§„åˆ™é©±åŠ¨**çš„æŠ€èƒ½æå–ç­–ç•¥ï¼š

- æ‰«æ `learn=true` çš„ browser æ‰§è¡Œè¯æ®
- æŠ½å–è¿ç»­å¯æ‰§è¡ŒåŠ¨ä½œæ®µï¼ˆé•¿åº¦ â‰¥ 2ï¼Œæ’é™¤å¤±è´¥ / åªè¯»åŠ¨ä½œï¼‰
- è‡ªåŠ¨åˆ›å»º browser candidate

è¿™ç§æ–¹å¼çš„å±€é™ï¼š

1. **æ— è¯­ä¹‰ç†è§£**ï¼šæŒ‰åŠ¨ä½œè¿ç»­æ€§åˆ‡å‰²ï¼Œæ— æ³•åˆ¤æ–­"è¿™ç»„åŠ¨ä½œå®Œæˆäº†ä¸€ä¸ªä»€ä¹ˆå«ä¹‰çš„å­ä»»åŠ¡"
2. **è¾¹ç•Œä¸å‡†**ï¼šå¯èƒ½æŠŠä¸¤ä¸ªåŠŸèƒ½æ€§ä¸ç›¸å…³ä½†æ—¶é—´è¿ç»­çš„åŠ¨ä½œåˆå¹¶ä¸ºä¸€ä¸ª skill
3. **æ— å»é‡**ï¼šä¸åŒ session ä¸­é‡å¤æ‰§è¡ŒåŒä¸€æ“ä½œæ¨¡å¼æ—¶ï¼Œä¼šåˆ›å»ºå¤§é‡è¯­ä¹‰é‡å¤çš„ candidate

#### 1.2 ç›®æ ‡è®¾è®¡

å¼•å…¥ **LLM è¾…åŠ©çš„è¯­ä¹‰åˆ†å‰²**ï¼Œåœ¨ç°æœ‰è§„åˆ™æŠ½å–çš„åŸºç¡€ä¸Šå åŠ æ™ºèƒ½å±‚ï¼š

```
åŸå§‹æ‰§è¡Œè¯æ® (action_timeline)
    â”‚
    â–¼
è§„åˆ™é¢„ç­›é€‰ (ç°æœ‰é€»è¾‘ä¿æŒä¸å˜)
  â†’ è¿ç»­åŠ¨ä½œæ®µ â‰¥ 2
  â†’ æ’é™¤å¤±è´¥/åªè¯»
    â”‚
    â–¼
LLM è¯­ä¹‰åˆ†æ (æ–°å¢)
  â†’ å­ä»»åŠ¡è¾¹ç•Œè¯†åˆ«
  â†’ è¯­ä¹‰å‘½åå’Œæè¿°
  â†’ ä¸ç°æœ‰ skill_key å»é‡åˆ¤æ–­
    â”‚
    â–¼
candidate åˆ›å»º (ç°æœ‰é€»è¾‘)
```

#### 1.3 å…³é”®æŠ€æœ¯å†³ç­–

| å†³ç­–ç‚¹ | é€‰é¡¹ | å»ºè®® |
|---|---|---|
| LLM è°ƒç”¨ä½ç½® | scheduler å†…éƒ¨ / ç‹¬ç«‹å¾®æœåŠ¡ | scheduler å†…éƒ¨è°ƒç”¨ï¼Œé€šè¿‡é…ç½®å†³å®šæ˜¯å¦å¯ç”¨ |
| æ¨¡å‹é€‰æ‹© | GPT-4 / GPT-4.1-mini / æœ¬åœ°æ¨¡å‹ | é¦–é€‰ GPT-4.1-miniï¼ˆæˆæœ¬/è´¨é‡å¹³è¡¡ï¼‰ï¼Œé…ç½®åŒ– |
| å¤±è´¥é™çº§ | LLM ä¸å¯ç”¨æ—¶çš„è¡Œä¸º | é™çº§å›è§„åˆ™æå–ï¼Œä¿è¯å¯ç”¨æ€§ |
| å»é‡ç­–ç•¥ | ç²¾ç¡® skill_key åŒ¹é… / è¯­ä¹‰ç›¸ä¼¼åº¦ | å…ˆç”¨ skill_key + description embedding ä½™å¼¦ç›¸ä¼¼åº¦ |

#### 1.4 è½åœ°å»ºè®®

1. åœ¨ `BrowserLearningScheduler` ä¸­æ–°å¢ `_semantic_analysis` é˜¶æ®µï¼Œå¯é€šè¿‡ `BrowserLearningConfig` å¼€å…³æ§åˆ¶
2. å®šä¹‰ prompt æ¨¡æ¿ï¼šè¾“å…¥ = åŠ¨ä½œåºåˆ— + ä¸Šä¸‹æ–‡ï¼Œè¾“å‡º = `{name, description, boundary_start, boundary_end, variables}`
3. å¢åŠ é…ç½®é¡¹ `browser_learning.semantic_extraction_enabled: bool`ï¼ˆé»˜è®¤ `false`ï¼Œæ¸è¿›å¯ç”¨ï¼‰
4. æ·»åŠ æŒ‡æ ‡ï¼šè¯­ä¹‰æå–æˆåŠŸç‡ã€ä¸è§„åˆ™æå–çš„ä¸€è‡´æ€§ã€candidate å»é‡å‘½ä¸­ç‡

---

### 2. æŠ€èƒ½å‚æ•°åŒ–ï¼ˆå˜é‡æå–ï¼‰

#### 2.1 ç°çŠ¶

å½“å‰ candidate é€šè¿‡ `payload_ref` å…³è”åŸå§‹æ‰§è¡Œè¯æ®ï¼ˆ`ArtifactBlob`ï¼‰ï¼Œå­˜å‚¨çš„æ˜¯å®Œæ•´çš„æ“ä½œåºåˆ—å’Œä¸Šä¸‹æ–‡ã€‚ä½†è¿™äº›åºåˆ—æ˜¯**ç¡¬ç¼–ç **çš„ï¼š

```json
// å½“å‰: åŠ¨ä½œåºåˆ—ä¸å…·ä½“å€¼ç»‘å®š
{"action": "type", "args": ["e552", "Edinburgh"]}
```

å¦‚æœæƒ³æœç´¢"Edinburgh â†’ Manchester"ä»¥å¤–çš„èˆªç­ï¼Œéœ€è¦ä¸€ä¸ªå…¨æ–°çš„ skillã€‚

#### 2.2 ç›®æ ‡è®¾è®¡

åœ¨ skill payload ä¸­å¼•å…¥ **variables å±‚**ï¼Œå°†ç¡¬ç¼–ç å€¼æŠ½è±¡ä¸ºå¯æ›¿æ¢å‚æ•°ï¼š

```json
{
  "actions": [
    {"action": "type", "args": ["e552", "${departure_city}"]}
  ],
  "variables": {
    "departure_city": {
      "type": "string",
      "default_value": "Edinburgh",
      "description": "å‡ºå‘åŸå¸‚åç§°",
      "action_index": 1,
      "arg_position": 1
    }
  }
}
```

å›æ”¾æ—¶é€šè¿‡ `run_skill` ä¼ å…¥å‚æ•°è¦†ç›–é»˜è®¤å€¼ã€‚

#### 2.3 å…³é”®æŠ€æœ¯å†³ç­–

| å†³ç­–ç‚¹ | é€‰é¡¹ | å»ºè®® |
|---|---|---|
| å‚æ•°è¯†åˆ«æ–¹å¼ | è§„åˆ™ï¼ˆtype åŠ¨ä½œçš„ args[1]ï¼‰/ LLM æ¨ç† | å…ˆç”¨è§„åˆ™è¦†ç›– 80% åœºæ™¯ï¼ŒLLM å…œåº• |
| payload æ ¼å¼æ‰©å±• | åœ¨ç°æœ‰ `ArtifactBlob.payload_json` ä¸­å¢åŠ å­—æ®µ / æ–°è¡¨ | åœ¨ payload_json ä¸­å¢åŠ  `variables` å­—æ®µï¼ˆå‘åå…¼å®¹ï¼‰ |
| run_skill å…¥å£å˜æ›´ | æ–°å¢ `variables` å‚æ•°åˆ° `POST .../skills/{key}/run` | æ˜¯ï¼Œbody å¢åŠ  `variables: dict` å¯é€‰å­—æ®µ |
| å˜é‡ç±»å‹çº¦æŸ | è‡ªç”±æ–‡æœ¬ / æšä¸¾ / æ­£åˆ™æ ¡éªŒ | å…ˆæ”¯æŒ `string` / `number` / `enum`ï¼Œç±»å‹ä¿¡æ¯å­˜åœ¨ variables å®šä¹‰ä¸­ |

#### 2.4 è½åœ°å»ºè®®

1. åœ¨ `SkillPayloadCreateRequest` ä¸­æ‰©å±• payload schemaï¼Œæ”¯æŒ `variables` å­—æ®µ
2. ä¿®æ”¹ `browser/skills/{skill_key}/run` æ¥å£ï¼Œæ¥å— `variables` å‚æ•°
3. Gull ä¾§å›æ”¾æ—¶åšå˜é‡æ›¿æ¢ï¼ˆåœ¨æ‰§è¡ŒåŠ¨ä½œå‰ï¼Œå°† `${var_name}` æ›¿æ¢ä¸ºå®é™…å€¼ï¼‰
4. æå–é˜¶æ®µï¼ˆscheduler æˆ–è¯­ä¹‰åˆ†æï¼‰è‡ªåŠ¨è¯†åˆ«å“ªäº›å‚æ•°å€¼æ˜¯"å¯å˜çš„"

---

### 3. å›æ”¾å®¹é”™ / Recovery æœºåˆ¶

#### 3.1 ç°çŠ¶

`POST /v1/sandboxes/{id}/browser/skills/{skill_key}/run` æ‰§è¡ŒæŠ€èƒ½å›æ”¾ã€‚ä½† Web é¡µé¢æ˜¯åŠ¨æ€çš„ï¼š

- å…ƒç´ çš„ DOM ç»“æ„å¯èƒ½å˜åŒ–ï¼ˆç½‘ç«™æ›´æ–°ã€AB æµ‹è¯•ï¼‰
- å…ƒç´ å¼•ç”¨ï¼ˆrefï¼‰åœ¨é¡µé¢å˜åŒ–åå¤±æ•ˆ
- åŠ¨æ€åŠ è½½çš„å†…å®¹å¯¼è‡´æ—¶åºå·®å¼‚

å½“å‰ç¼ºä¹ç³»ç»Ÿæ€§çš„æ•…éšœæ¢å¤æœºåˆ¶ã€‚

#### 3.2 ç›®æ ‡è®¾è®¡

å¼•å…¥ä¸‰çº§å®¹é”™ç­–ç•¥ï¼š

```
Level 1: è¯­ä¹‰å±æ€§å®šä½ (aria-label + role)
  â†’ ä¸ä¾èµ– refï¼Œè€Œæ˜¯é€šè¿‡å…ƒç´ è¯­ä¹‰å±æ€§åŒ¹é…
  â†’ å¯¹ DOM ç»“æ„å˜åŒ–æœ‰å¤©ç„¶å®¹å¿åº¦

Level 2: ç›¸ä¼¼åº¦æ¨¡ç³ŠåŒ¹é…
  â†’ aria-label ç²¾ç¡®åŒ¹é…å¤±è´¥æ—¶ï¼Œä½¿ç”¨å­—ç¬¦ä¸²ç›¸ä¼¼åº¦åŒ¹é…
  â†’ åŒæ—¶è¿‡æ»¤ element roleï¼ˆbutton/input/link ç­‰ï¼‰é¿å…è¯¯åŒ¹é…

Level 3: LLM Recovery Agent
  â†’ ä»¥ä¸Šå‡å¤±è´¥æ—¶ï¼Œå°†å½“å‰é¡µé¢å¿«ç…§ + ç›®æ ‡æ“ä½œæè¿°å‘ç»™ LLM
  â†’ LLM åˆ†æé¡µé¢ç»“æ„ï¼Œè¿”å›æ›¿ä»£å…ƒç´  / SKIP / FAIL
```

#### 3.3 å…³é”®æŠ€æœ¯å†³ç­–

| å†³ç­–ç‚¹ | é€‰é¡¹ | å»ºè®® |
|---|---|---|
| å®ç°ä½ç½® | Gull å†…éƒ¨ / Bay ç¼–æ’å±‚ | Gull å†…éƒ¨ï¼ˆæ›´æ¥è¿‘æµè§ˆå™¨è¿è¡Œæ—¶ï¼Œå»¶è¿Ÿæ›´ä½ï¼‰ |
| LLM è°ƒç”¨æˆæœ¬æ§åˆ¶ | æ¯æ¬¡å¤±è´¥éƒ½è°ƒ / æ‰¹é‡è°ƒ / é™åˆ¶é¢‘ç‡ | è®¾å®š `max_recovery_attempts_per_skill`ï¼ˆé»˜è®¤ 3ï¼‰ |
| å¿«ç…§æ ¼å¼ | DOM snapshot / æ— éšœç¢æ ‘ / æˆªå›¾ | ä¼˜å…ˆæ— éšœç¢æ ‘ï¼ˆæ–‡æœ¬æ›´ç´§å‡‘ï¼Œtoken æ¶ˆè€—å°‘ï¼‰ |
| ç»“æœåé¦ˆ | å›æ”¾æˆåŠŸ/å¤±è´¥å†™å…¥ health æŒ‡æ ‡ | æ˜¯ï¼ŒåŒºåˆ† `direct_success` / `recovery_success` / `recovery_failed` |

#### 3.4 è½åœ°å»ºè®®

1. åœ¨ skill payload ä¸­ä¸ºæ¯ä¸ªåŠ¨ä½œæ–°å¢ `element_label`ï¼ˆaria-labelï¼‰å’Œ `element_role` å­—æ®µ
2. Gull å›æ”¾å¼•æ“å…ˆç”¨ `element_label` åœ¨å½“å‰å¿«ç…§ä¸­æŸ¥æ‰¾å…ƒç´ ï¼Œè€Œéç›´æ¥ç”¨ ref
3. æ–°å¢ `recovery_strategy` é…ç½®ï¼ˆ`none` / `fuzzy_match` / `llm_agent`ï¼‰
4. å›æ”¾ç»“æœå¢åŠ  `recovery_used: bool` å’Œ `recovery_details` å­—æ®µï¼Œä¾› health åˆ†æä½¿ç”¨

---

## é˜¶æ®µäºŒï¼šå¹³å°åŒ–å¢å¼º ğŸŸ¡

åœ¨æ ¸å¿ƒèƒ½åŠ›ç¨³å®šåï¼Œå¢å¼ºå¹³å°çš„æ ‡å‡†åŒ–ã€å¯ç®¡ç†æ€§å’Œå¯è§‚æµ‹æ€§ã€‚

---

### 4. è¯„æµ‹æ ‡å‡†åŒ– / å†…ç½®åŸºå‡†

#### 4.1 ç°çŠ¶

`POST /v1/skills/candidates/{id}/evaluate` æ˜¯çº¯å¼€æ”¾å¼æ¥å£ï¼š
- è°ƒç”¨æ–¹è‡ªè¡Œä¼ å…¥ `passed: bool`, `score: float`, `benchmark_id: str`, `report: str`
- Bay åªåšè®°å½•å’ŒçŠ¶æ€è½¬æ¢ï¼Œä¸å‚ä¸è¯„æµ‹é€»è¾‘
- `benchmark_id` æ˜¯è‡ªç”±æ–‡æœ¬ï¼Œæ— æ³¨å†Œå’Œç®¡ç†æœºåˆ¶

#### 4.2 ç›®æ ‡è®¾è®¡

å¼•å…¥ **Benchmark Registry**ï¼š

```
Benchmark å®šä¹‰
â”œâ”€â”€ benchmark_id: "google-flights-search-v1"
â”œâ”€â”€ description: "Google Flights æœºç¥¨æœç´¢åœºæ™¯"
â”œâ”€â”€ task_set: [                          # æ ‡å‡†ä»»åŠ¡é›†
â”‚     {"task": "æœç´¢åŒ—äº¬â†’ä¸Šæµ· 1/20 å•ç¨‹", "expected": {...}},
â”‚     {"task": "æœç´¢å¾€è¿” NYCâ†’LAX", "expected": {...}},
â”‚   ]
â”œâ”€â”€ scoring_criteria:                    # è¯„åˆ†æ ‡å‡†
â”‚     method: "llm_as_judge"             # æˆ– "exact_match" / "regex" / "custom"
â”‚     model: "gpt-4.1-mini"
â”‚     rubric: "ä»»åŠ¡æ˜¯å¦å®Œå…¨å®Œæˆï¼Œç»“æœæ˜¯å¦æ­£ç¡®..."
â”œâ”€â”€ pass_threshold: 0.85
â””â”€â”€ min_samples: 10
```

#### 4.3 å…³é”®æŠ€æœ¯å†³ç­–

| å†³ç­–ç‚¹ | é€‰é¡¹ | å»ºè®® |
|---|---|---|
| Benchmark å­˜å‚¨ | æ•°æ®åº“è¡¨ / é…ç½®æ–‡ä»¶ / ArtifactBlob | æ–°å¢ `SkillBenchmark` è¡¨ï¼ˆSQLModelï¼‰ |
| è‡ªåŠ¨è¯„æµ‹æ‰§è¡Œ | Bay å†…éƒ¨æ‰§è¡Œ / å¤–éƒ¨ worker / è°ƒç”¨æ–¹é©±åŠ¨ | å¤–éƒ¨ worker + Bay åªç®¡æ³¨å†Œå’Œè®°å½•ï¼ˆä¿æŒåŸºå»ºå®šä½ï¼‰ |
| LLM-as-Judge | å†…ç½®åˆ° Bay / æä¾›è¯„æµ‹ SDK | æä¾›è¯„æµ‹ SDK/å·¥å…·ï¼ŒBay åªè®°å½•ç»“æœï¼ˆé¿å…è€¦åˆï¼‰ |
| è¯„åˆ†æ–¹æ³•æ‰©å±• | å›ºå®šå‡ ç§ / æ’ä»¶å¼ | é¢„ç½® `exact_match` / `regex` / `llm_as_judge`ï¼Œæ”¯æŒ `custom` |

#### 4.4 è½åœ°å»ºè®®

1. æ–°å¢ Benchmark CRUD APIï¼š`POST/GET /v1/skills/benchmarks`
2. è¯„æµ‹æ—¶å…³è” benchmarkï¼š`evaluate` æ¥å£çš„ `benchmark_id` ä»è‡ªç”±æ–‡æœ¬å˜ä¸ºå¤–é”®å¼•ç”¨
3. æä¾›è¯„æµ‹ SDK å·¥å…·ï¼š`BenchmarkRunner` ç±»ï¼Œè‡ªåŠ¨ä» benchmark åŠ è½½ä»»åŠ¡é›†ã€æ‰§è¡Œã€å†™ç»“æœ
4. æ”¯æŒ batch evaluateï¼šä¸€æ¬¡ evaluate è·‘å®Œæ•´ä¸ª benchmark çš„æ‰€æœ‰ä»»åŠ¡

---

### 5. æŠ€èƒ½å‘ç°ä¸ç¼–æ’

#### 5.1 ç°çŠ¶

æŠ€èƒ½é€šè¿‡ `skill_key`ï¼ˆå­—ç¬¦ä¸²ï¼‰æ‰å¹³ç®¡ç†ï¼š
- `list_releases(skill_key="enter-departure-location")` æŒ‰ key ç²¾ç¡®è¿‡æ»¤
- æ— åˆ†ç±»ã€æ ‡ç­¾ã€æœç´¢èƒ½åŠ›
- æ— æŠ€èƒ½é—´ä¾èµ–æˆ–æ‰§è¡Œé¡ºåºå®šä¹‰

#### 5.2 ç›®æ ‡è®¾è®¡

**5.2.1 æŠ€èƒ½å…ƒæ•°æ®ä¸å‘ç°**

```python
# Candidate åˆ›å»ºæ—¶æ”¯æŒæ›´ä¸°å¯Œçš„å…ƒæ•°æ®
await client.skills.create_candidate(
    skill_key="enter-departure-location",
    domain="travel",                    # é¢†åŸŸæ ‡ç­¾
    capabilities=["browser", "input"],  # èƒ½åŠ›æ ‡ç­¾
    preconditions={"url_pattern": "google.com/travel/flights"},  # å‰ç½®æ¡ä»¶
    postconditions={"url_pattern": "google.com/travel/flights"},  # åç½®æ¡ä»¶
    ...
)

# è¯­ä¹‰æœç´¢
results = await client.skills.search(
    query="è¾“å…¥å‡ºå‘åŸå¸‚",
    domain="travel",
    limit=5,
)
```

**5.2.2 æŠ€èƒ½ç¼–æ’ DAG**

```yaml
# Skill Pipeline å®šä¹‰
pipeline:
  name: "search-one-way-flight"
  steps:
    - skill_key: "initialize-flight-search-page"
    - skill_key: "enter-departure-location"
      variables: { departure_city: "${input.from}" }
      depends_on: ["initialize-flight-search-page"]
    - skill_key: "enter-destination-location"
      variables: { destination_city: "${input.to}" }
      depends_on: ["enter-departure-location"]
    - skill_key: "set-ticket-type-to-one-way"
      depends_on: ["enter-destination-location"]
    - skill_key: "submit-flight-search"
      depends_on: ["set-ticket-type-to-one-way"]
```

#### 5.3 è½åœ°å»ºè®®

1. **çŸ­æœŸ**ï¼š`SkillCandidate` æ¨¡å‹å¢åŠ  `domain`ã€`tags`ã€`preconditions_json`ã€`postconditions_json` å­—æ®µ
2. **ä¸­æœŸ**ï¼šæ–°å¢ `GET /v1/skills/search` ç«¯ç‚¹ï¼ˆåŸºäºæ ‡ç­¾ + æè¿°å…¨æ–‡æ£€ç´¢ï¼‰
3. **é•¿æœŸ**ï¼šæ–°å¢ `SkillPipeline` æ¨¡å‹å’Œ `POST /v1/skills/pipelines/{id}/run` ç«¯ç‚¹

---

### 6. æŠ€èƒ½ç‰ˆæœ¬ Diff / å½’å› 

#### 6.1 ç°çŠ¶

`SkillRelease` æœ‰ `version: int` å’Œ `rollback_of: str` å­—æ®µï¼Œæ”¯æŒç‰ˆæœ¬è¿½è¸ªå’Œå›æ»šå…³è”ã€‚ä½†æ— æ³•ç›´æ¥æŸ¥çœ‹ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´çš„è¡Œä¸ºå·®å¼‚ã€‚

#### 6.2 ç›®æ ‡è®¾è®¡

```python
# ç‰ˆæœ¬ diff API
diff = await client.skills.diff_releases(
    release_a="rel-001",  # v1
    release_b="rel-002",  # v2
)
# è¿”å›:
# {
#   "added_actions": [...],
#   "removed_actions": [...],
#   "modified_actions": [...],
#   "variable_changes": {...},
#   "payload_size_change": "+2.3KB",
# }
```

#### 6.3 è½åœ°å»ºè®®

1. æ–°å¢ `GET /v1/skills/releases/{id_a}/diff/{id_b}` ç«¯ç‚¹
2. é€šè¿‡ `candidate_id â†’ payload_ref â†’ ArtifactBlob` é“¾è·¯è·å–ä¸¤ä¸ªç‰ˆæœ¬çš„ payload
3. å¯¹ payload JSON åšç»“æ„åŒ– diffï¼ˆåŠ¨ä½œçº§åˆ«ï¼Œéæ–‡æœ¬è¡Œçº§åˆ«ï¼‰
4. å›æ»šå®¡è®¡æ—¥å¿—ä¸­è‡ªåŠ¨åŒ…å« diff æ‘˜è¦ï¼Œè¾…åŠ©è¿ç»´æ’éšœ

---

## é˜¶æ®µä¸‰ï¼šç”Ÿæ€åŒ–æ¼”è¿› ğŸŸ¢

æŠ€èƒ½ç³»ç»Ÿè§„æ¨¡åŒ–åçš„é•¿æœŸæ¼”è¿›æ–¹å‘ã€‚

---

### 7. è·¨ç¯å¢ƒæŠ€èƒ½è¿ç§»

#### 7.1 é—®é¢˜

åœ¨ Sandbox Aï¼ˆUbuntu + Chrome 120ï¼‰ä¸­å­¦åˆ°çš„ browser æŠ€èƒ½ï¼Œèƒ½å¦åœ¨ Sandbox Bï¼ˆUbuntu + Chrome 130 / ä¸åŒåˆ†è¾¨ç‡ / ä¸åŒè¯­è¨€ï¼‰ä¸­æ­£å¸¸æ‰§è¡Œï¼Ÿ

å½“å‰æŠ€èƒ½å®šä¹‰å¯èƒ½éšå¼ä¾èµ–ç‰¹å®šç¯å¢ƒï¼š
- å…ƒç´ ä½ç½®å’Œæ–‡æœ¬å› æµè§ˆå™¨ç‰ˆæœ¬è€Œå¼‚
- å¸ƒå±€å› åˆ†è¾¨ç‡è€Œå¼‚
- aria-label å› è¯­è¨€è®¾ç½®è€Œå¼‚

#### 7.2 ç›®æ ‡è®¾è®¡

- æŠ€èƒ½å®šä¹‰ä¸­å¢åŠ  **ç¯å¢ƒçº¦æŸå£°æ˜**ï¼ˆ`env_constraints`ï¼‰ï¼š

```json
{
  "env_constraints": {
    "browser": "chrome",
    "browser_version_min": "120",
    "locale": "en-US",
    "viewport_min_width": 1024
  }
}
```

- è·¨ç¯å¢ƒè¿ç§»æ—¶è‡ªåŠ¨åš**å…¼å®¹æ€§æ£€æŸ¥**ï¼š
  - ç¯å¢ƒåŒ¹é… â†’ ç›´æ¥å›æ”¾
  - ç¯å¢ƒä¸åŒ¹é… â†’ è§¦å‘é€‚é…å›æ”¾ï¼ˆå¯ç”¨ Recovery æœºåˆ¶ï¼‰æˆ– æ ‡è®°ä¸ºä¸å¯ç”¨

#### 7.3 è½åœ°å»ºè®®

1. `SkillCandidate` å¢åŠ  `env_constraints_json` å­—æ®µ
2. `run_skill` è¯·æ±‚æ—¶è‡ªåŠ¨è·å–å½“å‰ sandbox çš„ profile/ç¯å¢ƒä¿¡æ¯
3. ä¸åŒ¹é…æ—¶è¿”å› warning è€Œéç›´æ¥å¤±è´¥ï¼Œè®©è°ƒç”¨æ–¹å†³å®šé£é™©

---

### 8. å¤š Agent æŠ€èƒ½å…±äº«

#### 8.1 é—®é¢˜

å½“å‰ Skills æ˜¯ per-owner éš”ç¦»çš„ã€‚ä½†å¾ˆå¤šæŠ€èƒ½æ˜¯é€šç”¨çš„ï¼ˆå¦‚ "Google Flights æœç´¢"ï¼‰ï¼Œä¸åŒ owner çš„ Agent å„è‡ªå­¦ä¹ ç›¸åŒæŠ€èƒ½æ˜¯èµ„æºæµªè´¹ã€‚

#### 8.2 ç›®æ ‡è®¾è®¡

å¼•å…¥ **æŠ€èƒ½å¯è§æ€§** å’Œ **å…±äº«æœºåˆ¶**ï¼š

```
å¯è§æ€§çº§åˆ«:
â”œâ”€â”€ private (é»˜è®¤)    â†’ ä»… owner å¯è§
â”œâ”€â”€ org               â†’ åŒç»„ç»‡å†…å¯è§
â””â”€â”€ public            â†’ æ‰€æœ‰ç”¨æˆ·å¯ç”¨

å…±äº«æµç¨‹:
1. Owner A å‘å¸ƒ skill v3 (stage=stable, visibility=private)
2. Owner A æ ‡è®° visibility=public
3. Owner B æœç´¢åˆ°è¯¥ skill â†’ fork åˆ°è‡ªå·±åä¸‹
4. Owner B çš„ fork ç‹¬ç«‹ç®¡ç†ç‰ˆæœ¬å’Œå›æ»š
```

#### 8.3 è½åœ°å»ºè®®

1. `SkillRelease` å¢åŠ  `visibility` å­—æ®µï¼ˆ`private` / `org` / `public`ï¼‰
2. `list_releases` å¢åŠ  `include_public: bool` å‚æ•°
3. æ–°å¢ `POST /v1/skills/releases/{id}/fork` ç«¯ç‚¹ï¼ˆåˆ›å»ºå±äºå½“å‰ owner çš„å‰¯æœ¬ï¼‰
4. è€ƒè™‘æŠ€èƒ½ä¿¡ç”¨å’Œè´¡çŒ®è€…è¿½è¸ªï¼ˆ`original_owner`ã€`fork_count`ï¼‰

---

### 9. æŠ€èƒ½æˆæœ¬è¿½è¸ª

#### 9.1 é—®é¢˜

æ— æ³•é‡åŒ–æŠ€èƒ½å¤ç”¨å¸¦æ¥çš„æˆæœ¬èŠ‚çœã€‚Agent ä½¿ç”¨ skill å›æ”¾ vs. è‡ªä¸»æ¢ç´¢çš„æˆæœ¬å·®å¼‚ä¸å¯è§ã€‚

#### 9.2 ç›®æ ‡è®¾è®¡

æ¯æ¬¡ `run_skill` å’Œæ™®é€š `browser/exec` éƒ½è®°å½•æˆæœ¬ç»´åº¦ï¼š

```json
// ExecutionHistory æ‰©å±•
{
  "cost_metrics": {
    "token_input": 1200,
    "token_output": 350,
    "execution_time_ms": 4500,
    "llm_calls": 0,              // skill å›æ”¾é€šå¸¸ä¸éœ€è¦ LLM
    "recovery_llm_calls": 1,     // å¦‚æœè§¦å‘äº† Recovery Agent
    "estimated_cost_usd": 0.002
  },
  "cost_comparison": {
    "skill_replay_cost": 0.002,
    "estimated_exploration_cost": 0.15,  // åŸºäºå†å²æ•°æ®æ¨ç®—
    "savings_ratio": 0.987
  }
}
```

#### 9.3 è½åœ°å»ºè®®

1. `ExecutionHistory` å¢åŠ  `token_input`ã€`token_output`ã€`llm_calls` å­—æ®µ
2. æ–°å¢ `GET /v1/skills/analytics` ç«¯ç‚¹ï¼Œè¿”å›èšåˆæŒ‡æ ‡ï¼š
   - å„ skill_key çš„è°ƒç”¨æ¬¡æ•°ã€æˆåŠŸç‡ã€å¹³å‡è€—æ—¶
   - æŠ€èƒ½å›æ”¾ vs. è‡ªä¸»æ¢ç´¢çš„ token æ¶ˆè€—å¯¹æ¯”
   - æŠ€èƒ½åº“æ€»èŠ‚çœæˆæœ¬ä¼°ç®—
3. æŒ‰æ—¶é—´ç»´åº¦æä¾›è¶‹åŠ¿æ•°æ®ï¼ˆæŠ€èƒ½åº“å¢é•¿æ›²çº¿ã€å¤ç”¨ç‡æ›²çº¿ï¼‰

---

### 10. ä¸»åŠ¨å­¦ä¹  / æŠ€èƒ½ç¼ºå£æ£€æµ‹

#### 10.1 é—®é¢˜

å½“å‰æŠ€èƒ½æå–æ˜¯**è¢«åŠ¨**çš„ â€” åªåœ¨ Agent æˆåŠŸæ‰§è¡Œä¸”æ ‡è®° `learn=true` åæ‰è§¦å‘ã€‚ç³»ç»Ÿä¸ä¼šä¸»åŠ¨åˆ†æ"å“ªäº›æ“ä½œæ¨¡å¼åå¤å‡ºç°å´æ²¡æœ‰å¯¹åº”æŠ€èƒ½"ã€‚

#### 10.2 ç›®æ ‡è®¾è®¡

å¼•å…¥ **æŠ€èƒ½ç¼ºå£æ£€æµ‹å™¨**ï¼š

```
ç¼ºå£æ£€æµ‹æµç¨‹:

1. å®šæœŸæ‰«æè¿‘ N å¤©çš„ ExecutionHistory
2. èšç±»åˆ†æ:
   - æŒ‰æ“ä½œåºåˆ—ç›¸ä¼¼åº¦èšç±»
   - è¯†åˆ«é«˜é¢‘æ“ä½œæ¨¡å¼ï¼ˆå‡ºç° â‰¥ K æ¬¡ï¼‰
3. ä¸ç°æœ‰ skill_key å¯¹æ¯”:
   - å·²æœ‰æŠ€èƒ½è¦†ç›– â†’ ç»Ÿè®¡å¤ç”¨ç‡
   - æœªè¢«æŠ€èƒ½è¦†ç›– â†’ æ ‡è®°ä¸º"å€™é€‰ç¼ºå£"
4. ç”Ÿæˆå»ºè®®æŠ¥å‘Š:
   - "æ£€æµ‹åˆ° 15 æ¬¡ç›¸ä¼¼çš„ 'ç™»å½• Gmail' æ“ä½œåºåˆ—ï¼Œå»ºè®®æå–ä¸ºæŠ€èƒ½"
   - "æŠ€èƒ½ 'enter-departure-location' å¤ç”¨ç‡ 87%ï¼Œè¡¨ç°è‰¯å¥½"
   - "æŠ€èƒ½ 'filter-non-stop-flights' è¿‘ 7 å¤©æˆåŠŸç‡ä¸‹é™è‡³ 62%ï¼Œå»ºè®®æ£€æŸ¥"
```

#### 10.3 å…³é”®æŠ€æœ¯å†³ç­–

| å†³ç­–ç‚¹ | é€‰é¡¹ | å»ºè®® |
|---|---|---|
| èšç±»æ–¹å¼ | åŠ¨ä½œåºåˆ—ç¼–è¾‘è·ç¦» / LLM embedding | å…ˆç”¨ç¼–è¾‘è·ç¦»ï¼ˆä½æˆæœ¬ï¼‰ï¼Œåç»­å‡çº§ embedding |
| æ£€æµ‹é¢‘ç‡ | å®æ—¶ / æ¯æ—¥ / æ¯å‘¨ | æ¯æ—¥ä¸€æ¬¡ï¼ˆcron jobï¼‰ï¼Œå¯é…ç½® |
| è¾“å‡ºæ–¹å¼ | API æŸ¥è¯¢ / æ¨é€é€šçŸ¥ / æ—¥å¿— | æ–°å¢ `GET /v1/skills/insights` + å¯é€‰ webhook |
| é˜ˆå€¼é…ç½® | å›ºå®š / å¯é…ç½® | å¯é…ç½®ï¼ˆ`gap_detection.min_occurrences`, `gap_detection.similarity_threshold`ï¼‰ |

#### 10.4 è½åœ°å»ºè®®

1. æ–°å¢åå°å®šæ—¶ä»»åŠ¡ `SkillGapDetector`ï¼ŒæŒ‚è½½åˆ° scheduler ä½“ç³»
2. æ–°å¢ `GET /v1/skills/insights` ç«¯ç‚¹ï¼Œè¿”å›ï¼š
   - `skill_gaps`: é«˜é¢‘é‡å¤æ“ä½œä½†æ— å¯¹åº”æŠ€èƒ½
   - `underperforming_skills`: æˆåŠŸç‡ä¸‹é™çš„æŠ€èƒ½
   - `top_skills`: å¤ç”¨ç‡æœ€é«˜çš„æŠ€èƒ½
3. é…ç½®é¡¹ï¼š`skill_insights.enabled`, `skill_insights.scan_interval_hours`, `skill_insights.min_occurrences`

---

## è½åœ°ä¼˜å…ˆçº§æ€»è§ˆ

```
                   ä½å®ç°å¤æ‚åº¦ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ é«˜å®ç°å¤æ‚åº¦
                        â”‚                           â”‚
é«˜ä¸šåŠ¡ä»·å€¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
                        â”‚  â‘¡ æŠ€èƒ½å‚æ•°åŒ–              â”‚  â‘  æå–æ™ºèƒ½åŒ–
                        â”‚  â‘¢ å›æ”¾å®¹é”™                â”‚
                        â”‚                           â”‚
                        â”‚  â‘£ è¯„æµ‹æ ‡å‡†åŒ–              â”‚  â‘¤ å‘ç°ä¸ç¼–æ’
                        â”‚  â‘¥ ç‰ˆæœ¬ Diff               â”‚
                        â”‚                           â”‚
ä½ä¸šåŠ¡ä»·å€¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
                        â”‚  â‘¨ æˆæœ¬è¿½è¸ª               â”‚  â‘¦ è·¨ç¯å¢ƒè¿ç§»
                        â”‚                           â”‚  â‘§ å¤š Agent å…±äº«
                        â”‚                           â”‚  â‘© ç¼ºå£æ£€æµ‹
                        â”‚                           â”‚
```

**å»ºè®®è½åœ°é¡ºåº**ï¼šâ‘¡ â†’ â‘¢ â†’ â‘  â†’ â‘£ â†’ â‘¨ â†’ â‘¥ â†’ â‘¤ â†’ â‘© â†’ â‘¦ â†’ â‘§

ç†ç”±ï¼šå‚æ•°åŒ–ï¼ˆâ‘¡ï¼‰å’Œå®¹é”™ï¼ˆâ‘¢ï¼‰ç›´æ¥æå‡ç°æœ‰ skill çš„å®ç”¨æ€§ï¼Œä¸”å¯¹ç°æœ‰æ¥å£æ”¹åŠ¨æœ€å°ï¼›æ™ºèƒ½æå–ï¼ˆâ‘ ï¼‰ä»·å€¼æœ€é«˜ä½†å®ç°è¾ƒé‡ï¼Œå¯ä¸å‰ä¸¤è€…å¹¶è¡Œæ¨è¿›ã€‚

---

## é™„å½•ï¼šå‚è€ƒæ¥æº

- Shipyard Neo ç°æœ‰å®ç°ï¼š`app/services/skills/` (service.py / scheduler.py / lifecycle.py)
- CAMEL-AI `test_skill_puzhen` åˆ†æ”¯ï¼šæµè§ˆå™¨æŠ€èƒ½æå–/å›æ”¾/æµ‹è¯„å‚è€ƒå®ç°
- CRAB Benchmark (CAMEL-AI, 2024)ï¼šè·¨ç¯å¢ƒ Agent è¯„æµ‹æ–¹æ³•
- SETA (CAMEL-AI, 2026-01)ï¼šå¯æ‰©å±•ç»ˆç«¯ Agent è¯„æµ‹ç¯å¢ƒ
- WebArenaï¼šWeb Agent äº¤äº’è¯„æµ‹æ ‡å‡†
- AgentBenchï¼šå¤šç¯å¢ƒé€šç”¨ Agent è¯„æµ‹
- BFCL (Berkeley)ï¼šå‡½æ•°è°ƒç”¨å‡†ç¡®æ€§åŸºå‡†
